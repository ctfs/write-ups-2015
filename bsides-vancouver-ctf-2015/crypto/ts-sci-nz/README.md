# Vancouver BSides CTF 2015: ts/sci/nz

**Category:** Crypto
**Points:** 200
**Solves:** 4
**Description:** 

> TOP SECRET MUST NOT BE SHARED OUTSIDE NZHQ
> 
> Hello,
> 
> We intercepted this transmission sent yesterday morning being sent to Adelaide. Based on our observations it came from Canberra so we can only assume it was a government transmission. Based on new intelligence, they're using a new machine to encipher their text and at this time we're unsure of what they're doing to get the message across.
> 
> Please decipher this at the earliest possible and deliver it to my handler in Christchurch. We must not let the Queen take back our land.
> 
> 4e3b5f5c6f8a4e4c7f0a6d3b7f7c2d4a
>
> 3e0a4f7c0d4c6e8a3e6b3d3b3d0a3f6c
>
> 7e0a6f6b5f9c0d8a4e3b0d7b3e2c4f7a
>
> 4f3b6e8a0d2a6e3a0d6a8e7c8d0a6e6c
>
> 8d0a2e3b0d3a3e2c4f7a4e3b7e3b3d0a
>
> 2e9c0d2a6e9c0d8b6e2a8e8a4e6c7e4c
>
> 7f3b3d0a7d2a7e8a9f0a7f4b6f8b5f3a
>
> 0d9c6f8b0d6b6f8a0d2b3e0a2d8b8d4b
>
> 6f7b4f7c3e3a0d8a6f0a3d3b2f6c3d3b
>
> 0d8a4e4c7f0a6d3b7f7c2d4a3e0a9f6c
>
> 8e0a9d4c5f5c0d2b3e0a7d7b6f7c3e2c
>
> 8e8a3e3a0d4c6e0a6f8b7e0a6d2a5d3b
>
> 7f8a9f7c0d2c6f8b7e8a0d2a8d0a4f8a
>
> 7f0a3f8b5f5c3e7c8d4c3f0a9f6c8e0a
>
> 2d7b3e0a4f6b0d2a3d3b5f2a4f3a3e0a
>
> 7d5c3e2a7f3b0d6a2d5b3e0a9f6c8e7b
>
> 0d9a2d9c0d8a6f0a4e6c2e2a7e8a0d8a
>
> 6f0a2f6c6e8a2d2c8d0a6d4c6e4c7f8a
>
> 3e7b0d3c8e5c5f3b7e0a2d8a0d9c6f8b
>
> 7e0a3e2a7e5c4f3b7f8a0d9a3e0a4e2a
>
> 8f3b0d2a0d7a2d2c5e2a4d3b0d9a2d4c
>
> 8d4c6e4a0d8a6f0a2e3b0d7a4f2c5e3b
>
> 3d0a8e7a0d8a4e3b7e3b0d9a4e4c2f4b
>
> 0d6a8e7c8d0a2e3b0d3a3e5c4f8c3e7b
>
> 3e3a0d8a6f0a8d4b3e0a7f9c3d6b3e9c
>
> 0d4b2d7b2e6c8e7b0d2b7e4c3d4a3e0a
>
> 2d8a0d4c8d7c0d3b2d7b5f4c3e7c8d0a
>
> 9f6c8e0a9d4c5f5c0d6a3e3b8d0a9d4c
>
> 8d4b0d2b7e4c8d4c7f4b0d2a6e3a0d2c
>
> 2d6b2d3a4f2a6e0a6f3c3f4c2f4c2d5c
>
> 7f0a9d4b6f0a9d4c5f5c0d4a8e4c3d3b
>
> 0d9c6f8b0d8a6f0a2d0a9d2a4f8a4f6b
>
> 4d0a2f2a7e0a2d8a0d9a4e4c2f4b0d7a
>
> 6f4c6e8a0d9c6f8b0d9a4f5c5f0a2e3b
>
> 0d7a7e6c8f4c3d3b3d0a9d4c8d4b0d3c
>
> 8e7b8d4b3e7b0d3a3e8a2d4c5f7c9d4b
>
> 3e6b0d9c6f8b0d6a3e3b8d0a8d4b3e0a
>
> 6f3c3f4c2f4c2d5c7f0a7d5c3e2a7f3b
>
> 0d7a7e6c8f4c3d3b0d8a4e3b6d0a9d4c
>
> 8d4b0d8a4e3b0d3c6f5c5f6c9d4c6e4a
>
> 0d3c5f2a4d8a4e3b7d2a2f5b2d4a3e7c
>
> 2d7b3e2a8d7a3e7b8d4b6e6c7e8a4e9a
>
> 3e0a4e6c7d3b0d8a4e2a8d0a8d4b4f7c
>
> 0d6a3e7c7f2a4d3b0d6a2d5b3e7c0d4c
>
> 8d0a8d6c0d9c6f8b0d7c2d3c3e5c9f9c
>
> 6f8b7e7c0d4c6e0a7f8b2f2c3e7c7f0a
>
> 4f6b0d8a4e3b0d9a2d7b0d3b3f3c6f7b
>
> 8d6a4f6b4f7c8d3b7e0a8d4b6f6a2d7c
> 
> Yours truly in defeating the Australians,
> Minister Stevensons

## Write-up

Please read the writeup by the CTF organisers/task author [here](https://github.com/yvrctf/2015/tree/master/ts-sci-nz). This writeup is based on the original writeup.

In this task, we had to notice that these supposed MD5 hashes do have a certain pattern (number and letter pairs) and that this is a [keypad](http://dialabc.com/motion/keypads.html) cipher using the Australian keypad as key.

On the one side, we have the following substitution:

```
0 - Space
1 - QZ
2 - ABC
3 - DEF
4 - GHI
5 - JKL
6 - MNO
7 - PRS
8 - TUV
9 - WXY
```

Given a string of even length, we can split the string into number-letter pairs:

```
4B3B5C5C6C => 4B 3B 5C 5C 6C
```

The number of each pair is the key for the substitution, the letter is the position of the value

(`A=0, B=1, C=2, D=0, E=1, F=2`):

```
4B:
4 => 4 - GHI
B => Second position of GHI => H

3B:
3 => 3 - DEF
B => Second position of DEF => E
[...]

Result: HELLO
```

To counter frequency analysis, a shift parameter is used that adds an increasing shift value (modulo 10), starting at e.g. `2`, to the number of each pair:

```
 4B3B5C5C6C
+2 3 4 5 6 
-----------
 6B6B9C0C2C
```

I have implemented a simple [python script](https://github.com/YASME-Tim/crypto-tools/tree/master/aus-dial-pad) that can decrypt and encrypt a given ciphertext/cleartext:

```
$ python ausdialpad.py 4 "$(cat cip)"
HELLOTHIS MESSAGE IS INTENDED FOR ONLY THE RECIPIENT AND MUST NOT BE DECIPHERED BY ANY UNAUTHORISED PARTY SHOULD YOU NOT BE AUTHORISED TO DECODE THIS MESSAGE YOU WILL BE PROSECUTED IN OUR MAJESTYS COURT AT ITS FULLESTIF YOU ARE IN ADELAIDE PLEASE MAKE YOUR WAY TO HOBART TO CONTACT MINISTER FULLER AT YOUR EARLIEST WE HAVE A PACKAGE WAITING TO BE PICKED UP THERE WHICH MUST BE DELIVERED TO THE SYDNEY HARBOUR BRIDGE AT ITS EARLIEST YOU WILL MEET WITH BRITISH AND CANADIAN OFFICIALS WHO WILL GUIDE YOU TO A WAITING CAR AT WHICH POINT YOU WILL BE PROVIDED WITH FURTHER DETAILSWHEN YOU MEET THE OFFICIALS PLEASE PROVIDE THEM WITH THE FOLLOWING FLAGTHEPACKAGESAREATPERTHNORTHWE HOPE THAT THIS MESSAGE MAKES IT TO YOU SAFELYYOURS IN SUCCESS IN THE WAR EFFORTMINISTER THOMAS
```

The flag is `THEPACKAGESAREATPERTHNORTH`.

## Other write-ups and resources

* <http://colin.keigher.ca/2015/03/an-australian-specific-cipher.html>
* <https://github.com/yvrctf/2015/tree/master/ts-sci-nz>